using System;
using DataTransferObjects;
using DataTransferObjects.Requests;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Threading.Tasks;
using System.Windows.Input;
using Xamarin.Forms;
using XamarinForms.Helpers;
using XamarinForms.Views;

namespace XamarinForms.ViewModels
{
    public class RegistracijaViewModel : BaseViewModel
    {
        private readonly APIService _serviceKupacKorisnickiNalog;
        private readonly APIService _kupacService;


        public Kupac Kupac { get; set; }
        public string NovaLozinka { get; set; }
        public string PotvrdaLozinke { get; set; }

        #region Default Avatar string base64

        private const string AvatarDefault = "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";

        #endregion

        private readonly byte[] _defaultAvatar = Convert.FromBase64String(AvatarDefault);

        public RegistracijaViewModel()
        {
            Kupac = new Kupac { Slika = File.ReadAllBytes("defaultAvatar.png") };
            _kupacService = new APIService("Kupac");
            _serviceKupacKorisnickiNalog = new APIService("Kupac");
        }

        public ICommand InsertKupacCommand { get; set; }

        public async Task InsertKupac(byte[] slika = null)
        {
            if (slika == null)
                slika = _defaultAvatar;

            KupacKorisnickiNalogInsertRequest request = new KupacKorisnickiNalogInsertRequest
            {
                Ime = Kupac.Ime,
                Prezime = Kupac.Prezime,
                Email = Kupac.Email,
                Telefon = Kupac.Telefon,
                KorisnickoIme = Kupac.KorisnickoIme,
                Slika = slika,
                Password = NovaLozinka,
                PasswordPotvrda = PotvrdaLozinke
            };


            try
            {
                var response = await _serviceKupacKorisnickiNalog.Insert<Kupac>(request);

                APIService.Username = request.KorisnickoIme;
                APIService.Password = request.Password;

                if (response != null)
                    try
                    {
                        var list = await _kupacService.Get<List<DataTransferObjects.Kupac>>(null);
                        KupacData.Set(list.FirstOrDefault(w => w.KorisnickoIme == Kupac.KorisnickoIme));
                        Application.Current.MainPage = new MainPage();
                        await Application.Current.MainPage.DisplayAlert("Informacija", "Uspješno ste se registrovali", "OK");
                    }
                    catch
                    {
                        // ignored
                    }

            }
            catch
            {
                await Application.Current.MainPage.DisplayAlert("Greška", "Provjerite podatke i pokušajte ponovo", "OK");
            }
        }

    }
}
